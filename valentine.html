<!DOCTYPE html>
<html>
<head>
  <title>Valentine Reveal</title>
  <style>
    body {
      background: linear-gradient(270deg, #ffdde1, #ee9ca7);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      font-family: Arial, sans-serif;
      text-align: center;
      color: #333;
      overflow: hidden;
    }
    @keyframes gradientShift {
      0% {background-position:0% 50%;}
      50% {background-position:100% 50%;}
      100% {background-position:0% 50%;}
    }
    h1 { color: #cc0066; }
    .checker-box {
      margin: 40px auto;
      padding: 20px;
      border: 3px solid #cc0066;
      width: 60%;
      background: #ffe6f0;
      box-shadow: 0 0 20px #ff99cc;
      border-radius: 12px;
    }
    input { padding: 8px; margin: 5px; width: 80%; }
    button {
      padding: 8px 16px;
      background: #cc0066;
      color: white;
      border: none;
      cursor: pointer;
    }
    #result { margin-top: 20px; font-weight: bold; }
    .romantic {
      font-size: 1.2em;
      color: #cc0066;
      margin-top: 20px;
      animation: fadeIn 3s ease-in-out;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .heart { font-size: 2em; color: red; animation: pulse 1.5s infinite; }
    @keyframes pulse { 0% { transform: scale(1);} 50% { transform: scale(1.2);} 100% { transform: scale(1);} }
    .falling { position: fixed; top: -50px; font-size: 2em; animation: fall linear infinite; }
    @keyframes fall { 0% { transform: translateY(-50px) rotate(0deg); opacity: 1;} 100% { transform: translateY(100vh) rotate(360deg); opacity: 0;} }
    .floating { position: fixed; bottom: -50px; font-size: 2em; animation: floatUp linear infinite; }
    @keyframes floatUp { 0% { transform: translateY(100vh) rotate(0deg); opacity: 0;} 50% { opacity: 1;} 100% { transform: translateY(-50px) rotate(360deg); opacity: 0;} }
  </style>
</head>
<body>
  <h1>üíå Final Valentine Challenge</h1>
  <p>Enter all four flags you‚Äôve collected to unlock the special message.</p>
  
  <div class="checker-box">
    <form onsubmit="checkFlags(); return false;">
      <input type="text" id="flag1" placeholder="Enter Index Flag"><br>
      <input type="text" id="flag2" placeholder="Enter Crypto Flag"><br>
      <input type="text" id="flag3" placeholder="Enter Login Flag"><br>
      <input type="text" id="flag4" placeholder="Enter Stego Flag"><br>
      <button type="submit">Unlock</button>
    </form>
    <div id="result"></div>
  </div>

  <!-- Hidden audio elements -->
  <audio id="music_r0s3" loop><source src="music/reverie.mp3" type="audio/mpeg"></audio>
  <audio id="music_ananas" loop><source src="music/daydreams.mp3" type="audio/mpeg"></audio>
  <audio id="music_cole" loop><source src="music/love_spell.mp3" type="audio/mpeg"></audio>

<script>
  const correctHashes = {
    flag1: "8e54c0321c6e2f0c71813ac70b170f12a4c6412d2ef838fd6e900bc995c1580f",
    flag2: "cb4dcecadba9ebaa128fd346a88db3fecc22e2763575bbd6eb560f8ac9abfe23",
    flag3: "0bb092ccb800367230aa7a1e9bd874cb9e2d76b11f9394081a9cd6c4355377df",
    flag4: "4884c962b37e9ac79b6766b3fb1d078df7c0a4f6e676b40fff0ab3b75512c00d"
  };

  // Customizations keyed to password hashes from image.html
  const stegoCustomizations = {
    "6534c38a225caa5284a2217f797a3ed14236d62a3778c7d3d4707bdd441d9c89": {
      message: "üåπ With all the forgetfulness I have been given, I still remember you.",
      motif: "üåπ",
      audioId: "music_r0s3"
    },
    "06a4b0444ae1e6183e2e344f1dd1159373f6f2168213fe4d729b98d2079a17cc": {
      message: "üçç I threw all my dictionaries into the fire and named you my language.",
      motif: "üçç",
      audioId: "music_ananas"
    },
    "f78b6cb9224209fe21027f4f6addf57ef2fdf4392e9362095ea8de7377f5451e": {
      message: "üåø Even if the night sky were filled with stars, I'd rather see them through the reflection of your eyes.",
      motif: "üåø",
      audioId: "music_cole"
    }
  };

  async function sha256(str) {
    const buf = new TextEncoder().encode(str);
    const hashBuf = await crypto.subtle.digest("SHA-256", buf);
    return Array.from(new Uint8Array(hashBuf))
      .map(b => b.toString(16).padStart(2, "0"))
      .join("");
  }

  function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  async function checkFlags() {
    const f1 = document.getElementById("flag1").value.trim();
    const f2 = document.getElementById("flag2").value.trim();
    const f3 = document.getElementById("flag3").value.trim();
    const f4 = document.getElementById("flag4").value.trim();

    const h1 = await sha256(f1);
    const h2 = await sha256(f2);
    const h3 = await sha256(f3);
    const h4 = await sha256(f4);

    if (h1 === correctHashes.flag1 &&
        h2 === correctHashes.flag2 &&
        h3 === correctHashes.flag3 &&
        h4 === correctHashes.flag4) {

      // ‚úÖ All four flags validated
      const pathHash = getQueryParam("pathHash"); // from image.html link

      let romanticMessage = "üíñ You are my ultimate flag üíñ";
      let motif = "‚ù§Ô∏è";
      let audioId = null;

      if (stegoCustomizations[pathHash]) {
        romanticMessage = stegoCustomizations[pathHash].message;
        motif = stegoCustomizations[pathHash].motif;
        audioId = stegoCustomizations[pathHash].audioId;
        launchFallingMotifs(motif);
      }

      document.getElementById("result").innerHTML =
        "<h2 class='heart'>‚ù§Ô∏è Congratulations! ‚ù§Ô∏è</h2>" +
        "<p>You‚Äôve unlocked the final Valentine message:</p>" +
        "<h3 id='finalMessage'></h3>" +
        "<p class='romantic'>" + romanticMessage + "</p>";

      typeWriter("üíñ You are my ultimate flag üíñ", "finalMessage");

      if (audioId) fadeInAudio(document.getElementById(audioId));
      launchFloatingHearts("üíñ");
    } else {
      document.getElementById("result").innerHTML =
        "‚ùå Incorrect flags. Double-check and try again!";
    }
  }
</script>

